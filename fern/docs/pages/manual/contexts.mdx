## SQL Databases
Text-to-SQL querying has been tested for [MySQL](https://www.mysql.com/) in PrivateGPT.

The DB connection is established using [SQLAlchemy](https://www.sqlalchemy.org/), and allows connecting to a number of databases.
To use this feature, connection details for the DB are required.
A database name and list of tables allow PrivateGPT to select those as the query context.

### Install Dependencies
* Run the following command to install the dependencies for text-to-SQL:

```bash
  poetry install --with context_database
```

* Install an appropriate database driver:

```bash
  poetry add <db_driver>
```

* Set the following environment variables in `settings.yaml`:

```yaml
context_database:
  enabled: true
  db_dialect: <db_dialect_here>
  db_driver: <db_driver_here>
  db_host: <db_hostname_here>
  db_user: <db_username_here>
  db_password: <db_password_here>
  database: <database_name_here>
  tables: <comma_separated_table_names_here>  # eg: TABLE1,TABLE2,TABLE3
```

### Configuring Database
* Dialect is the system SQLAlchemy uses to communicate with different databases.
* Drivers are the connectors for databases.

To start using other SQL databases as context, set the `context_database.db_dialect` and `context_database.db_driver` properties in the `settings.yaml` file.

This configures a connection string as per the following format:
```bash
  db_dialect+db_driver://db_user:db_password@db_host/database
```

##### List of included Dialects in SQLAlchemy

| Database              | Dialect    | Driver Options                                            |
|-----------------------|------------|---------------------------------------------------------- |
| PostgreSQL            | postgresql | psycopg2/mysqlconnector/pg8000/asyncpg/                   |
| MySQL                 | mysql      | pymysql/mysqldb/mysqlconnector/asyncmy/aiomysql/cymysql   |
| MariaDB               | mariadb    | pymysql/mysqldb/mariadbconnector/asyncmy/aiomysql/cymysql |
| SQLite                | sqlite     | pysqlite/aiosqlite/pysqlcipher                            |
| Oracle                | oracle     | cx_oracle/python-oracledb                                 |
| Microsoft SQL Server  | mssql      | pyodbc/pymssql/aioodbc                                    |


##### Example connection strings

| Database              | Example |
|-----------------------|----------|
| MySQL                 | `mysql+pymysql://<username>:<password>@<host>/<dbname>`                 |
| MariaDB               | `mariadb+mariadbconnector://<user>:<password>@<host>[:<port>]/<dbname>` |
| PostgreSQL            | `postgresql+psycopg2://user:password@host:port/dbname`                  |
| SQLite                | `sqlite+pysqlite:///file_path`                                          |


##### Additional documentation
Refer to [SQLAlchemy Engine Configuration](https://docs.sqlalchemy.org/en/20/core/engines.html) for documentation about configuring SQLAlchemy and the DB connection string.

List of internal & external Dialects: https://docs.sqlalchemy.org/en/20/dialects/

PostgreSQL Documentation Reference: https://docs.sqlalchemy.org/en/20/dialects/postgresql.html